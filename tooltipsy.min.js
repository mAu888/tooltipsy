/* tooltipsy by Brian Cray
 *   modified version by MaurÃ­cio Hanika
 * Lincensed under GPL2 - http://www.gnu.org/licenses/gpl-2.0.html
 * Option quick reference:
 *  - alignTo: "element" or "cursor" (Defaults to "element")
 *  - offset: Tooltipsy distance from element or mouse cursor, dependent on alignTo setting. Set as array [x, y] (Defaults to [0, -1])
 *  - content: HTML or text content of tooltip. Defaults to "" (empty string), which pulls content from target element's title attribute
 *  - show: function(event, tooltip) to show the tooltip. Defaults to a show(100) effect
 *  - hide: function(event, tooltip) to hide the tooltip. Defaults to a fadeOut(100) effect
 *  - delay: A delay in milliseconds before showing a tooltip. Set to 0 for no delay. Defaults to 200
 *  - css: object containing CSS properties and values. Defaults to {} to use stylesheet for styles
 *  - className: DOM class for styling tooltips with CSS. Defaults to "tooltipsy"
 * More information visit http://tooltipsy.com/
 */
(function(b){b.tooltipsy=function(a,c){this.options=c;this.$el=b(a);this.title=this.$el.attr("title")||"";this.$el.attr("title","");this.random=parseInt(Math.random()*1E4);this.shown=this.ready=!1;this.bottom=this.right=this.top=this.left=this.height=this.width=0;this.pos=[0,0];this.posYRel=this.posXRel="";this.delayouttimer=this.delaytimer=null;this.$el.data("tooltipsy",this);this.init()};b.tooltipsy.prototype.init=function(){var a=this;a.settings=b.extend(!0,{},a.defaults,a.options);a.settings.delay=
parseInt(a.settings.delay);typeof a.settings.content==="function"&&a.readify();a.$el.bind("mouseenter",function(c){a.settings.delay>0?a.delaytimer=window.setTimeout(function(){window.clearTimeout(a.delayouttimer);a.delayouttimer=null;a.enter(c)},a.settings.delay):(window.clearTimeout(a.delayouttimer),a.delayouttimer=null,a.enter(c))}).bind("mouseleave",function(c){if(b(c.relatedTarget).parents().filter(a.$tipsy).length>0)return!1;a.settings.delayOut>0?(window.clearTimeout(a.delaytimer),a.delaytimer=
null,a.delayouttimer=window.setTimeout(function(){a.leave(c)},a.settings.delayOut)):(window.clearTimeout(a.delaytimer),a.delaytimer=null,a.leave(c))})};b.tooltipsy.prototype.enter=function(a){this.ready===!1&&this.readify();this.shown===!1&&function(a){var b=0,e;for(e in a)a.hasOwnProperty(e)&&b++;return b}(this.settings.css)>0&&this.$tip.css(this.settings.css);this.positions();this.shown=!0;this.settings.alignTo==="cursor"?(this.pos=[a.pageX+this.settings.offset[0],a.pageY+this.settings.offset[1]],
b(window).width()):this.pos=[this.getPosX(),this.getPosY()];this.settings.pointer?this.$pointer.position(this.pos):this.$pointer.disable();this.$tipsy.css({top:this.pos[1]+"px",left:this.pos[0]+"px"});this.settings.show(a,this.$tipsy.stop(!0,!0))};b.tooltipsy.prototype.positions=function(){this.$tipsy.show();this.width=this.$tipsy.outerWidth();this.height=this.$tipsy.outerHeight();this.left=this.$tipsy.offset().left;this.top=this.$tipsy.offset().top;this.right=this.$tipsy.offset().left+this.width;
this.bottom=this.$tipsy.offset().top+this.height;this.$tipsy.hide();this.$el.width=this.$el.outerWidth();this.$el.height=this.$el.outerHeight();this.$el.left=this.$el.offset().left;this.$el.top=this.$el.offset().top;this.$el.right=this.$el.left+this.$el.width;this.$el.bottom=this.$el.top+this.$el.height;this.$el.center={top:this.$el.offset().top+Math.abs(this.$el.outerHeight()/2),left:this.$el.offset().left+Math.abs(this.$el.outerWidth()/2)}};b.tooltipsy.prototype.getPosX=function(a){a=this.settings.offset[0];
this.checkPosX()||(a=this.getOptimizedPosX());return a<0?(this.posXRel="left",this.$el.left-this.width+a):a===0?(this.posXRel="center",this.$el.left-Math.abs((this.width-this.$el.width)/2)):(this.posXRel="right",this.$el.right+a)};b.tooltipsy.prototype.checkPosX=function(){var a=this.settings.offset[0],c=b(document).scrollLeft(),d=c+b(window).width();return a<0&&this.$el.left-c<this.width?!1:a===0&&(this.$el.left-c<this.width/2||d<this.$el.center.left+this.width/2)?!1:a>0&&d<this.$el.right+this.width?
!1:!0};b.tooltipsy.prototype.getOptimizedPosX=function(){var a=b(document).scrollLeft(),c=a+b(window).width();if(this.width<this.$el.left||this.width<c-this.$el.right){var d=this.settings.offset[0]===0?1:this.settings.offset[0];return this.$el.left-a>c-this.$el.right?-1*Math.abs(d):1*Math.abs(d)}else throw"larger tooltip width than viewport not yet implemented";};b.tooltipsy.prototype.getPosY=function(){var a=this.settings.offset[1];this.checkPosY()||(a=this.getOptimizedPosY());return a<0?(this.posYRel=
"top",this.$el.top-this.height+a):a===0?(this.posYRel="center",this.$el.top-(this.height-this.$el.height)/2):(this.posYRel="bottom",this.$el.bottom)};b.tooltipsy.prototype.checkPosY=function(){var a=this.settings.offset[1],c=b(document).scrollTop()+b(window).height();return a<0&&this.$el.top<this.height?!1:a===0&&(this.$el.center.top<this.height/2||c<this.$el.bottom+this.height/2)?!1:a>0&&c<this.$el.bottom+this.height?!1:!0};b.tooltipsy.prototype.getOptimizedPosY=function(){var a=b(document).scrollTop()+
b(window).height();if(this.height<this.$el.top||this.height<a-this.$el.bottom){var c=this.settings.offset[1]===0?1:this.settings.offset[1];return this.$el.top>a-this.$el.bottom?-1*Math.abs(c):1*Math.abs(c)}else throw"larger tooltip height than viewport not yet implemented";};b.tooltipsy.prototype.leave=function(a){var b=this;a.relatedTarget===b.$tip[0]?b.$tip.bind("mouseleave",function(a){a.relatedTarget!==b.$el[0]&&(b.settings.hide(a,b.$tipsy.stop(!0,!0)),tipsy_open=!1)}):b.settings.hide(a,b.$tipsy.stop(!0,
!0))};b.tooltipsy.prototype.readify=function(){var a=this;this.ready=!0;a.settings.container!==""?(a.$tipsy=b(a.settings.container),a.$tip=a.$tipsy.children("."+a.settings.classes.tip).first(),a.$pointer=a.$tipsy.children("."+a.settings.classes.pointer).first()):(a.$tipsy=b('<div id="tooltipsy'+a.random+'" class="'+a.settings.classes.tipsy+'">').appendTo("body"),a.$tip=b('<div class="'+a.settings.classes.tip+'">').appendTo(a.$tipsy).html(a.settings.content!=""?a.settings.content:a.title),a.$pointer=
b('<div id="pointer'+a.random+'" style="position:absolute;" class="'+a.settings.classes.pointer+'">').appendTo(a.$tipsy));a.$pointer=new b.tooltipsy.pointer(a.$pointer,this);a.$tipsy.css({display:"none",position:"absolute",zIndex:"2147483646"});a.$tipsy.hover(function(){window.clearTimeout(a.delayouttimer);a.$tipsy.css({zIndex:"2147483647"})},function(){a.$el.mouseleave();a.$tipsy.css({zIndex:"2147483646"})})};b.tooltipsy.prototype.offset=function(a){var b=ot=0;if(a.offsetParent){do b+=a.offsetLeft,
ot+=a.offsetTop;while(a=a.offsetParent)}return{left:b,top:ot}};b.tooltipsy.prototype.overlaps=function(){if(this.$tipsy.offset().left+this.$tipsy.outerWidth()>=this.$el.center.left&&this.$tipsy.offset().top+this.$tipsy.outerHeight()>=this.$el.center.top&&this.$tipsy.offset().left<=this.$el.center.left&&this.$tipsy.offset().top<=this.$el.center.top)return!0;return!1};b.tooltipsy.prototype.defaults={alignTo:"element",offset:[0,-1],pointerOffset:[0,0],container:"",content:"",show:function(a,b){b.fadeIn(100)},
hide:function(a,b){b.fadeOut(100)},css:{},classes:{tipsy:"tooltipsy",tip:"tip",pointer:"pointer"},delay:200,pointer:!1};b.fn.tooltipsy=function(a){return this.each(function(){new b.tooltipsy(this,a)})};b.tooltipsy.pointer=function(a,c){this.$el=b(a);this.tipsy=c;this.width=this.$el.outerWidth();this.height=this.$el.outerHeight();this.pos=["center","center"];this.$el.css({position:"absolute"})};b.tooltipsy.pointer.prototype.disable=function(){this.$el.hide()};b.tooltipsy.pointer.prototype.position=
function(a){var b=this.getPosX(a[0]),a=this.getPosY(a[1]),d=this.tipsy.settings.classes.pointer;this.$el.css({left:b+"px",top:a+"px",position:"absolute"});this.$el.removeClass(d+"-posy-top "+d+"-posy-center "+d+"-posy-bottom "+d+"-posx-left "+d+"-posx-center "+d+"-posx-right");this.$el.addClass(d+"-posx-"+this.pos[0]);this.$el.addClass(d+"-posy-"+this.pos[1]);this.$el.show()};b.tooltipsy.pointer.prototype.getPosX=function(){var a=this.tipsy.settings.pointerOffset[0];return this.tipsy.posXRel=="right"?
(this.tipsy.pos[0]+=this.width+a,this.pos[0]="left",-1*(this.width+a)):this.tipsy.posXRel=="center"?(this.pos[0]="center",this.tipsy.width/2-this.width/2+a):(this.tipsy.pos[0]-=this.width+a,this.pos[0]="right",this.tipsy.width+a)};b.tooltipsy.pointer.prototype.getPosY=function(){var a=this.tipsy.settings.pointerOffset[1];return this.tipsy.posYRel=="bottom"?(this.tipsy.pos[1]+=this.height+a,this.pos[1]="top",-1*(this.height+a)):this.tipsy.posYRel=="center"?(this.pos[1]="center",this.tipsy.height/2-
this.height/2+a):(this.tipsy.pos[1]-=this.height+a,this.pos[1]="bottom",this.tipsy.height+a)}})(jQuery);